<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing &mdash; ape  documentation</title>
      <link rel="stylesheet" href="/ape/latest/_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="/ape/latest/_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="/ape/latest/_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="/ape/userguides/testing.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script data-domain="docs.apeworx.io" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/custom.js"></script>
  <script>
      var PROJECT = "ape";
  </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Scripting" href="scripts.html" />
    <link rel="prev" title="Proxy Contracts" href="proxy.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ape
              <img src="../_static/logo.gif" class="logo" alt="Logo"/>
          </a>

          <div class="version">
            <label for="version-picker" id="version-picker-label">Version:</label>
            <select id="version-picker">
              <option value="">Select version...</option>
              <option value="latest">latest</option>
              <option value="stable">stable</option>
                <option value="v0.7.11">v0.7.11</option>
                <option value="v0.7.10">v0.7.10</option>
                <option value="v0.7.9">v0.7.9</option>
                <option value="v0.7.8">v0.7.8</option>
                <option value="v0.7.7">v0.7.7</option>
                <option value="v0.7.6">v0.7.6</option>
                <option value="v0.7.5">v0.7.5</option>
                <option value="v0.7.4">v0.7.4</option>
                <option value="v0.7.3">v0.7.3</option>
                <option value="v0.7.2">v0.7.2</option>
                <option value="v0.7.1">v0.7.1</option>
                <option value="v0.7.0">v0.7.0</option>
                <option value="v0.6.27">v0.6.27</option>
                <option value="v0.6.26">v0.6.26</option>
                <option value="v0.6.25">v0.6.25</option>
                <option value="v0.6.24">v0.6.24</option>
                <option value="v0.6.23">v0.6.23</option>
                <option value="v0.6.22">v0.6.22</option>
                <option value="v0.6.21">v0.6.21</option>
                <option value="v0.6.20">v0.6.20</option>
                <option value="v0.6.19">v0.6.19</option>
                <option value="v0.6.18">v0.6.18</option>
                <option value="v0.6.17">v0.6.17</option>
                <option value="v0.6.16">v0.6.16</option>
                <option value="v0.6.15">v0.6.15</option>
                <option value="v0.6.14">v0.6.14</option>
                <option value="v0.6.13">v0.6.13</option>
                <option value="v0.6.12">v0.6.12</option>
                <option value="v0.6.11">v0.6.11</option>
                <option value="v0.6.10">v0.6.10</option>
                <option value="v0.6.9">v0.6.9</option>
                <option value="v0.6.8">v0.6.8</option>
                <option value="v0.6.7">v0.6.7</option>
                <option value="v0.6.6">v0.6.6</option>
                <option value="v0.6.5">v0.6.5</option>
                <option value="v0.6.4">v0.6.4</option>
                <option value="v0.6.3">v0.6.3</option>
                <option value="v0.6.2">v0.6.2</option>
                <option value="v0.6.1">v0.6.1</option>
                <option value="v0.6.0">v0.6.0</option>
                <option value="v0.5.9">v0.5.9</option>
                <option value="v0.5.8">v0.5.8</option>
                <option value="v0.5.7">v0.5.7</option>
                <option value="v0.5.6">v0.5.6</option>
                <option value="v0.5.5">v0.5.5</option>
                <option value="v0.5.4">v0.5.4</option>
                <option value="v0.5.3">v0.5.3</option>
                <option value="v0.5.2">v0.5.2</option>
                <option value="v0.5.1">v0.5.1</option>
                <option value="v0.5.0">v0.5.0</option>
                <option value="v0.4.5">v0.4.5</option>
                <option value="v0.4.4">v0.4.4</option>
                <option value="v0.4.3">v0.4.3</option>
                <option value="v0.4.2">v0.4.2</option>
                <option value="v0.4.1">v0.4.1</option>
                <option value="v0.4.0">v0.4.0</option>
                <option value="v0.3.5">v0.3.5</option>
                <option value="v0.3.4">v0.3.4</option>
                <option value="v0.3.3">v0.3.3</option>
                <option value="v0.3.2">v0.3.2</option>
                <option value="v0.3.1">v0.3.1</option>
                <option value="v0.3.0">v0.3.0</option>
                <option value="v0.2.8">v0.2.8</option>
                <option value="v0.2.7">v0.2.7</option>
                <option value="v0.2.6">v0.2.6</option>
                <option value="v0.2.5">v0.2.5</option>
                <option value="v0.2.4">v0.2.4</option>
                <option value="v0.2.3">v0.2.3</option>
                <option value="v0.2.2">v0.2.2</option>
                <option value="v0.2.1">v0.2.1</option>
                <option value="v0.2.0">v0.2.0</option>
                <option value="v0.1.6">v0.1.6</option>
                <option value="v0.1.5">v0.1.5</option>
                <option value="v0.1.4">v0.1.4</option>
                <option value="v0.1.3">v0.1.3</option>
                <option value="v0.1.1">v0.1.1</option>
                <option value="v0.1.0">v0.1.0</option>
            </select>
          </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Developing Projects with Ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="compile.html">Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="clis.html">CLIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Querying Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="forking_networks.html">Forking Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_plugins.html">Developing Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configure Ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Making Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html">Ape Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts.html">Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy Contracts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pytest">Pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-structure">Test Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-pattern">Test Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fixtures">Fixtures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accounts-fixture">accounts fixture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chain-fixture">chain fixture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#networks-fixture">networks fixture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-fixture">project fixture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contract-fixture">Contract fixture</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ape-testing-commands">Ape testing commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-providers">Test Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-testing-tips">Advanced Testing Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-transaction-failures">Testing Transaction Failures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#expected-message"><code class="docutils literal notranslate"><span class="pre">expected_message</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#dev-message"><code class="docutils literal notranslate"><span class="pre">dev_message</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#caveats">Caveats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#language-support">Language Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inlining">Inlining</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-reentrant-functions">Non-reentrant Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#custom-errors">Custom Errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multi-chain-testing">Multi-chain Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gas-reporting">Gas Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iterative-testing">Iterative Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contract-coverage">Contract Coverage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="publishing.html">Publishing</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CLI Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../commands/accounts.html">accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/compile.html">compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/pm.html">pm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/console.html">console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/init.html">init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/networks.html">networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/plugins.html">plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/run.html">run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/test.html">test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape.html">ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_accounts.html">ape-accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/api.html">ape.api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/cli.html">ape.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/contracts.html">ape.contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/exceptions.html">ape.exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/managers.html">ape.managers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/plugins.html">ape.plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/types.html">ape.types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/utils.html">ape.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ape</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Testing</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ApeWorX/ape/blob/main/docs/userguides/testing.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this heading"></a></h1>
<p>Testing an ape project is important and easy.</p>
<section id="pytest">
<h2>Pytest<a class="headerlink" href="#pytest" title="Permalink to this heading"></a></h2>
<p>Before learning how testing works in Ape, you should have an understanding of <a class="reference external" href="https://docs.pytest.org/en/7.4.x/">the pytest framework</a> and its concepts such as fixtures, mark-decorators, and pytest plugins such as x-dist, pytest-mock, and pytest-cov.
Once you have learned about pytest, Ape testing becomes intuitive because it is built on top of pytest.
In fact, <code class="docutils literal notranslate"><span class="pre">ape-test</span></code> is itself a <code class="docutils literal notranslate"><span class="pre">pytest</span></code> plugin!</p>
<p>You write your smart-contracts much like you write regular Python tests.</p>
</section>
<section id="test-structure">
<h2>Test Structure<a class="headerlink" href="#test-structure" title="Permalink to this heading"></a></h2>
<p>Tests must be located in a project’s <code class="docutils literal notranslate"><span class="pre">tests/</span></code> directory. Each <strong>test file</strong> must start with <code class="docutils literal notranslate"><span class="pre">test_</span></code> and have the <code class="docutils literal notranslate"><span class="pre">.py</span></code> extension, such as <code class="docutils literal notranslate"><span class="pre">test_my_contract.py</span></code>.
Each <strong>test method</strong> within the file must also start with <code class="docutils literal notranslate"><span class="pre">test_</span></code>.
The following is an example test:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: <code class="docutils literal notranslate"><span class="pre">pytest</span></code> assumes the <em>actual</em> value is on the left and the <em>expected</em> value is on the right.</p>
</section>
<section id="test-pattern">
<h2>Test Pattern<a class="headerlink" href="#test-pattern" title="Permalink to this heading"></a></h2>
<p>Tests are generally divisible into three parts:</p>
<ol class="arabic simple">
<li><p>Set-up</p></li>
<li><p>Invocation</p></li>
<li><p>Assertion</p></li>
</ol>
<p>An example of the setup-phase would be creating a <code class="docutils literal notranslate"><span class="pre">pytest.fixture</span></code> that deploys our smart contract.
(To learn more about pytest fixtures in Ape, see the <code class="docutils literal notranslate"><span class="pre">Fixtures</span></code> section below!)
For now, what you need to know is that it’s a piece of code that executes before the test runs, and it is decorated with a <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code>.</p>
<p>The second phase is <code class="docutils literal notranslate"><span class="pre">Invocation</span></code>, which encompasses invoking the function we are testing.
The last phase, <code class="docutils literal notranslate"><span class="pre">Assertion</span></code>, requires enacting on the expectation about how the code should behave.
Let’s assume there is an <code class="docutils literal notranslate"><span class="pre">authorized_method()</span></code> that requires the owner of the contract to make the transaction.
If the sender of the transaction is not the owner, the transaction will fail to complete and will revert.
We use <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements in Ape (and <code class="docutils literal notranslate"><span class="pre">pytest</span></code>) to check that our expectations are correct.
A test passes if all the <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements are <code class="docutils literal notranslate"><span class="pre">True</span></code> and it fails if any are <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>This is an example of how that test may look:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># SETUP PHASE</span>
<span class="c1"># NOTE: More on fixtures is discussed in later sections of this guide!</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">my_contract</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">owner</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_authorization</span><span class="p">(</span><span class="n">my_contract</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">not_owner</span><span class="p">):</span>
    <span class="c1"># INVOCATION PHASE</span>
    <span class="n">my_contract</span><span class="o">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">owner</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">owner</span> <span class="o">==</span> <span class="n">my_contract</span><span class="o">.</span><span class="n">owner</span><span class="p">()</span>

    <span class="c1"># ASSERTION PHASE</span>
    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="s2">&quot;!authorized&quot;</span><span class="p">):</span>
        <span class="n">my_contract</span><span class="o">.</span><span class="n">authorized_method</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">not_owner</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ape has built-in test and fixture isolation for all pytest scopes.
To disable isolation add the <code class="docutils literal notranslate"><span class="pre">--disable-isolation</span></code> flag when running <code class="docutils literal notranslate"><span class="pre">ape</span> <span class="pre">test</span></code></p>
</div>
</section>
<section id="fixtures">
<h2>Fixtures<a class="headerlink" href="#fixtures" title="Permalink to this heading"></a></h2>
<p>Now that we have discussed the full flow of a test, let’s dive deeper into the specific parts, starting with <code class="docutils literal notranslate"><span class="pre">pytest.fixtures</span></code>.</p>
<p>You can define and use <code class="docutils literal notranslate"><span class="pre">pytest</span></code> fixtures in your Ape tests.
Learn more about fixtures from <a class="reference external" href="https://docs.pytest.org/en/7.1.x/explanation/fixtures.html">this guide</a>.
The syntax and functionalities of fixtures work exactly the same in Ape as it does with <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ape-test</span></code> plugin comes with fixtures you will likely want to use.
The following guide explains each fixture that comes with Ape.</p>
<section id="accounts-fixture">
<h3>accounts fixture<a class="headerlink" href="#accounts-fixture" title="Permalink to this heading"></a></h3>
<p>You have access to test accounts.
These accounts are automatically funded, and you can use them to transact in your tests.
Access each <a class="reference external" href="../methoddocs/api.html?highlight=testaccount#ape.api.accounts.TestAccountAPI">test account</a> by index from the <code class="docutils literal notranslate"><span class="pre">accounts</span></code> fixture:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_my_method</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">receiver</span> <span class="o">=</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>For code readability and sustainability, create your own fixtures using the <code class="docutils literal notranslate"><span class="pre">accounts</span></code> fixture:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">receiver</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">test_my_method</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>You can configure your accounts by changing the <code class="docutils literal notranslate"><span class="pre">mnemonic</span></code> or <code class="docutils literal notranslate"><span class="pre">number_of_accounts</span></code> settings in the <code class="docutils literal notranslate"><span class="pre">test</span></code> section of your <code class="docutils literal notranslate"><span class="pre">ape-config.yaml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mnemonic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test test test test test test test test test test test junk</span>
<span class="w">  </span><span class="nt">number_of_accounts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<p>If you are running tests against <code class="docutils literal notranslate"><span class="pre">anvil</span></code>, your generated test accounts may not correspond to the <code class="docutils literal notranslate"><span class="pre">anvil</span></code>’s default generated accounts despite using the same mnemonic. In such a case, you are able to specify a custom derivation path in <code class="docutils literal notranslate"><span class="pre">ape-config.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mnemonic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test test test test test test test test test test test junk</span>
<span class="w">  </span><span class="nt">number_of_accounts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">hd_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;m/44&#39;/60&#39;/0&#39;/0/{}&quot;</span>
</pre></div>
</div>
<p>If you are using a fork-provider, such as <a class="reference external" href="https://github.com/ApeWorX/ape-hardhat">Hardhat</a>, you can use impersonated accounts by accessing random addresses off the fixture:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">vitalik</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="s2">&quot;0xab5801a7d398351b8be11c439e05c5b3259aec9b&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Using a fork-provider such as <a class="reference external" href="https://github.com/ApeWorX/ape-hardhat">Hardhat</a>, when using a contract instance as the sender in a transaction, it will be automatically impersonated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_my_method</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">accounts</span><span class="p">):</span>
    <span class="n">contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">other_contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">OtherContract</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">contract</span><span class="o">.</span><span class="n">my_method</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">other_contract</span><span class="p">)</span>
</pre></div>
</div>
<p>It has the same interface as the <a class="reference external" href="../methoddocs/managers.html#ape.managers.accounts.TestAccountManager">TestAccountManager</a>, (same as doing <code class="docutils literal notranslate"><span class="pre">accounts.test_accounts</span></code> in a script or the console).</p>
</section>
<section id="chain-fixture">
<h3>chain fixture<a class="headerlink" href="#chain-fixture" title="Permalink to this heading"></a></h3>
<p>Use the chain fixture to access the connected provider or adjust blockchain settings.</p>
<p>For example, increase the pending timestamp:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_in_future</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
    <span class="n">chain</span><span class="o">.</span><span class="n">pending_timestamp</span> <span class="o">+=</span> <span class="mi">86000</span>
    <span class="k">assert</span> <span class="s2">&quot;Something&quot;</span>
    <span class="n">chain</span><span class="o">.</span><span class="n">pending_timestamp</span> <span class="o">+=</span> <span class="mi">86000</span>
    <span class="k">assert</span> <span class="s2">&quot;Something else&quot;</span>
</pre></div>
</div>
<p>It has the same interface as the <a class="reference external" href="../methoddocs/managers.html#ape.managers.chain.ChainManager">ChainManager</a>.</p>
</section>
<section id="networks-fixture">
<h3>networks fixture<a class="headerlink" href="#networks-fixture" title="Permalink to this heading"></a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">networks</span></code> fixture to change the active provider in tests.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_multi_chain</span><span class="p">(</span><span class="n">networks</span><span class="p">):</span>
    <span class="k">assert</span> <span class="s2">&quot;Something&quot;</span>  <span class="c1"># Make assertion in root network</span>

    <span class="c1"># NOTE: Assume have ecosystem named &quot;foo&quot; with network &quot;local&quot; and provider &quot;bar&quot;</span>
    <span class="k">with</span> <span class="n">networks</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">use_provider</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s2">&quot;Something else&quot;</span>
</pre></div>
</div>
<p>It has the same interface as the <a class="reference external" href="../methoddocs/managers.html#ape.managers.networks.NetworkManager">NetworkManager</a>.</p>
</section>
<section id="project-fixture">
<h3>project fixture<a class="headerlink" href="#project-fixture" title="Permalink to this heading"></a></h3>
<p>You also have access to the <code class="docutils literal notranslate"><span class="pre">project</span></code> you are testing. You will need this to deploy your contracts in your tests.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">my_contract</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
    <span class="c1">#           ^ use the &#39;project&#39; fixture from the &#39;ape-test&#39; plugin</span>
    <span class="k">return</span> <span class="n">owner</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="p">)</span>
</pre></div>
</div>
<p>It has the same interface as the <a class="reference external" href="../methoddocs/managers.html#module-ape.managers.project.manager">ProjectManager</a>.</p>
</section>
<section id="contract-fixture">
<h3>Contract fixture<a class="headerlink" href="#contract-fixture" title="Permalink to this heading"></a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">Contract</span></code> fixture to create contract instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">my_contract</span><span class="p">(</span><span class="n">Contract</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Contract</span><span class="p">(</span><span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>It has the same interface as the <a class="reference external" href="../methoddocs/managers.html#ape.managers.chain.ChainManager">ChainManager</a>.</p>
</section>
</section>
<section id="ape-testing-commands">
<h2>Ape testing commands<a class="headerlink" href="#ape-testing-commands" title="Permalink to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>To run a particular test:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>test_my_contract
</pre></div>
</div>
<p>Use ape test <code class="docutils literal notranslate"><span class="pre">-I</span></code> to open the interactive mode at the point of exception. This allows the user to inspect the point of failure in your tests.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>test_my_contract<span class="w"> </span>-I<span class="w"> </span>-s
</pre></div>
</div>
</section>
<section id="test-providers">
<h2>Test Providers<a class="headerlink" href="#test-providers" title="Permalink to this heading"></a></h2>
<p>Out-of-the-box, your tests run using the <code class="docutils literal notranslate"><span class="pre">eth-tester</span></code> provider, which comes bundled with ape. If you have <code class="docutils literal notranslate"><span class="pre">geth</span></code> installed, you can use the <code class="docutils literal notranslate"><span class="pre">ape-geth</span></code> plugin that also comes with ape.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--network<span class="w"> </span>ethereum:local:geth
</pre></div>
</div>
<p>Each testing plugin should work the same way. You will have access to the same test accounts.</p>
<p>Another option for testing providers is the <a class="reference external" href="https://github.com/ApeWorX/ape-hardhat">ape-hardhat</a> plugin, which does not come with <code class="docutils literal notranslate"><span class="pre">ape</span></code> but can be installed by including it in the <code class="docutils literal notranslate"><span class="pre">plugins</span></code> list in your <code class="docutils literal notranslate"><span class="pre">ape-config.yaml</span></code> file or manually installing it using the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span>plugins<span class="w"> </span>install<span class="w"> </span>hardhat
</pre></div>
</div>
</section>
<section id="advanced-testing-tips">
<h2>Advanced Testing Tips<a class="headerlink" href="#advanced-testing-tips" title="Permalink to this heading"></a></h2>
<p>If you want to use sample projects, follow this link to <a class="reference external" href="https://github.com/ApeAcademy">Ape Academy</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>project                     # The root project directory
└── tests/                  # Project tests folder, ran using the &#39;ape test&#39; command to run all tests within the folder.
    └── conftest.py         # A file to define global variable for testing
    └── test_accounts.py    # A test file, if you want to ONLY run one test file you can use &#39;ape test test_accounts.py&#39; command
    └── test_mint.py        # A test file
</pre></div>
</div>
<p>Here is an example of a test function from a sample <a class="reference external" href="https://github.com/ApeAcademy/ERC721">NFT project</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_account_balance</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">nft</span><span class="p">):</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nft</span><span class="o">.</span><span class="n">mint</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">nft</span><span class="o">.</span><span class="n">PRICE</span><span class="p">()</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">owner</span><span class="p">)</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>
    <span class="n">expect</span> <span class="o">=</span> <span class="n">quantity</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expect</span>
</pre></div>
</div>
</section>
<section id="testing-transaction-failures">
<h2>Testing Transaction Failures<a class="headerlink" href="#testing-transaction-failures" title="Permalink to this heading"></a></h2>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">pytest.raises()</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">ape.reverts()</span></code> to assert that contract transactions fail and revert.</p>
<p>From our earlier example we can see this in action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_authorization</span><span class="p">(</span><span class="n">my_contract</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">not_owner</span><span class="p">):</span>
    <span class="n">my_contract</span><span class="o">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">owner</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">owner</span> <span class="o">==</span> <span class="n">my_contract</span><span class="o">.</span><span class="n">owner</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="s2">&quot;!authorized&quot;</span><span class="p">):</span>
        <span class="n">my_contract</span><span class="o">.</span><span class="n">authorized_method</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">not_owner</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">reverts()</span></code> takes two optional parameters:</p>
<section id="expected-message">
<h3><code class="docutils literal notranslate"><span class="pre">expected_message</span></code><a class="headerlink" href="#expected-message" title="Permalink to this heading"></a></h3>
<p>This is the expected revert reason given when the transaction fails.
If the message in the <code class="docutils literal notranslate"><span class="pre">ContractLogicError</span></code> raised by the transaction failure is empty or does not match the <code class="docutils literal notranslate"><span class="pre">expected_message</span></code>, then <code class="docutils literal notranslate"><span class="pre">ape.reverts()</span></code> will raise an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>.</p>
<p>You may also supply an <code class="docutils literal notranslate"><span class="pre">re.Pattern</span></code> object to assert on a message pattern, rather than on an exact match.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matches explicitly &quot;foo&quot; or &quot;bar&quot;</span>
<span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(foo|bar)$&quot;</span><span class="p">)):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="dev-message">
<h3><code class="docutils literal notranslate"><span class="pre">dev_message</span></code><a class="headerlink" href="#dev-message" title="Permalink to this heading"></a></h3>
<p>This is the expected dev message corresponding to the line in the contract’s source code where the error occurred.
These can be helpful in optimizing for gas usage and keeping revert reason strings shorter.</p>
<p>Dev messages take the form of a comment in Vyper, and should be placed on the line that may cause a transaction revert:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span>  <span class="c1"># dev: invalid value</span>
</pre></div>
</div>
<p>Take for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># @version 0.3.7</span>

<span class="nd">@external</span>
<span class="k">def</span> <span class="nf">check_value</span><span class="p">(</span><span class="n">_value</span><span class="p">:</span> <span class="n">uint256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">_value</span> <span class="o">!=</span> <span class="mi">0</span>  <span class="c1"># dev: invalid value</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>We can explicitly cause a transaction revert and check the failed line by supplying an expected <code class="docutils literal notranslate"><span class="pre">dev_message</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_authorization</span><span class="p">(</span><span class="n">my_contract</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="n">dev_message</span><span class="o">=</span><span class="s2">&quot;dev: invalid value&quot;</span><span class="p">):</span>
        <span class="n">my_contract</span><span class="o">.</span><span class="n">check_value</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">owner</span><span class="p">)</span>
</pre></div>
</div>
<p>When the transaction reverts and <code class="docutils literal notranslate"><span class="pre">ContractLogicError</span></code> is raised, <code class="docutils literal notranslate"><span class="pre">ape.reverts()</span></code> will check the source contract to see if the failed line contains a message.</p>
<p>There are a few scenarios where <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> will be raised when using <code class="docutils literal notranslate"><span class="pre">dev_message</span></code>:</p>
<ul class="simple">
<li><p>If the line in the source contract has a different dev message or no dev message</p></li>
<li><p>If the contract source cannot be obtained</p></li>
<li><p>If the transaction trace cannot be obtained</p></li>
</ul>
<p>Because <code class="docutils literal notranslate"><span class="pre">dev_message</span></code> relies on transaction tracing to function, you must use a provider like <a class="reference external" href="https://github.com/ApeWorX/ape-hardhat">ape-hardhat</a> when testing with <code class="docutils literal notranslate"><span class="pre">dev_message</span></code>.</p>
<p>You may also supply an <code class="docutils literal notranslate"><span class="pre">re.Pattern</span></code> object to assert on a dev message pattern, rather than on an exact match.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matches explictly &quot;dev: foo&quot; or &quot;dev: bar&quot;</span>
<span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="n">dev_message</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^dev: (foo|bar)$&quot;</span><span class="p">)):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="caveats">
<h3>Caveats<a class="headerlink" href="#caveats" title="Permalink to this heading"></a></h3>
<section id="language-support">
<h4>Language Support<a class="headerlink" href="#language-support" title="Permalink to this heading"></a></h4>
<p>As of <code class="docutils literal notranslate"><span class="pre">ape</span></code> version <code class="docutils literal notranslate"><span class="pre">0.5.6</span></code>, <code class="docutils literal notranslate"><span class="pre">dev_messages</span></code> assertions are available for contracts compiled with <a class="reference external" href="https://github.com/ApeWorX/ape-vyper">ape-vyper</a>, but not for those compiled with <a class="reference external" href="https://github.com/ApeWorX/ape-solidity">ape-solidity</a> or <a class="reference external" href="https://github.com/ApeWorX/ape-cairo">ape-cairo</a>.</p>
</section>
<section id="inlining">
<h4>Inlining<a class="headerlink" href="#inlining" title="Permalink to this heading"></a></h4>
<p>Due to function inlining, the position of the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">dev:</span> <span class="pre">...</span></code> message may sometimes be one line higher than expected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@external</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">_x</span><span class="p">:</span> <span class="n">decimal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">decimal</span><span class="p">:</span>  <span class="c1"># dev: correct location</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>  <span class="c1"># dev: incorrect location</span>
</pre></div>
</div>
<p>This typically only applies when trying to add dev messages to statements containing built-in function calls.</p>
</section>
<section id="non-reentrant-functions">
<h4>Non-reentrant Functions<a class="headerlink" href="#non-reentrant-functions" title="Permalink to this heading"></a></h4>
<p>Similarly, if you require dev assertions for non-reentrant functions you must be sure to leave the comment on the function that should not have reentry:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@internal</span>
<span class="nd">@nonreentrant</span><span class="p">(</span><span class="s1">&#39;lock&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_foo_internal</span><span class="p">():</span>  <span class="c1"># dev: correct location</span>
    <span class="k">pass</span>

<span class="nd">@external</span>
<span class="nd">@nonreentrant</span><span class="p">(</span><span class="s1">&#39;lock&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_foo_internal</span><span class="p">()</span>  <span class="c1"># dev: incorrect location</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-errors">
<h3>Custom Errors<a class="headerlink" href="#custom-errors" title="Permalink to this heading"></a></h3>
<p>As of Solidity 0.8.4, custom errors have been introduced to the ABI.
To make assertions on custom errors, you can use the types defined on your contracts.</p>
<p>For example, if I have a contract called <code class="docutils literal notranslate"><span class="pre">MyContract.sol</span></code>:</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span>

error<span class="w"> </span>Unauthorized<span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">unauth_address</span><span class="p">);</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">MyContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>owner<span class="p">)</span>
<span class="w">            </span>revert<span class="w"> </span>Unauthorized<span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span>
<span class="w">        </span>owner<span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I can ensure unauthorized withdraws are disallowed by writing the following test:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">hacker</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">contract</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">owner</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_unauthorized_withdraw</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">hacker</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">Unauthorized</span><span class="p">,</span> <span class="n">unauth_address</span><span class="o">=</span><span class="n">hacker</span><span class="o">.</span><span class="n">address</span><span class="p">):</span>
        <span class="n">contract</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">hacker</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also use custom error types from the contract container (from <code class="docutils literal notranslate"><span class="pre">ape.project</span></code> or the <code class="docutils literal notranslate"><span class="pre">project</span></code> fixture):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>

<span class="k">def</span> <span class="nf">test_unauthorized</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">hacker</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="o">.</span><span class="n">Unauthorized</span><span class="p">,</span> <span class="n">unauth_address</span><span class="o">=</span><span class="n">hacker</span><span class="o">.</span><span class="n">address</span><span class="p">):</span>
        <span class="n">contract</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">hacker</span><span class="p">)</span>
</pre></div>
</div>
<p>You may need to use the container approach for asserting on custom errors that occur during failing <code class="docutils literal notranslate"><span class="pre">deploy</span></code> transactions because you won’t have access to the contract instance yet.
Here is an example of what that may look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>

<span class="k">def</span> <span class="nf">test_error_on_deploy</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">MyCustomError</span><span class="p">):</span>
        <span class="n">ape</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">HasError</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can attempt to use the address from the revert error to find the error type.
<strong>NOTE</strong>: The address will only exist for transactions that were published (e.g. not for failures during estimating gas), and this may only work on certain providers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>

<span class="k">def</span> <span class="nf">test_error_on_deploy</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
    <span class="c1"># NOTE: We are using `as rev` here to capture the revert info</span>
    <span class="c1"># so we can attempt to lookup the contract later.</span>
    <span class="k">with</span> <span class="n">ape</span><span class="o">.</span><span class="n">reverts</span><span class="p">()</span> <span class="k">as</span> <span class="n">rev</span><span class="p">:</span>
        <span class="n">ape</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">HasError</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rev</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Receipt never found, contract never cached&quot;</span>
    
    <span class="c1"># Grab the cached instance using the error&#39;s address</span>
    <span class="c1"># and assert the custom error this way.</span>
    <span class="n">contract</span> <span class="o">=</span> <span class="n">ape</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="n">rev</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rev</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">MyError</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="multi-chain-testing">
<h2>Multi-chain Testing<a class="headerlink" href="#multi-chain-testing" title="Permalink to this heading"></a></h2>
<p>The Ape framework supports connecting to alternative networks / providers in tests.</p>
<p>To run an entire test using a specific network / provider combination, use the <code class="docutils literal notranslate"><span class="pre">use_network</span></code> pytest marker:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">use_network</span><span class="p">(</span><span class="s2">&quot;fantom:local:test&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_my_fantom_test</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">chain</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">ecosystem</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fantom&quot;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">use_network</span><span class="p">(</span><span class="s2">&quot;ethereum:local:test&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_my_ethereum_test</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">chain</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">ecosystem</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ethereum&quot;</span>
</pre></div>
</div>
<p>To switch networks mid-test, use the <code class="docutils literal notranslate"><span class="pre">networks</span></code> context-manager:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Switch to Fantom mid test</span>
<span class="k">def</span> <span class="nf">test_my_multichain_test</span><span class="p">(</span><span class="n">networks</span><span class="p">):</span>
    <span class="c1"># The test starts in 1 ecosystem but switches to another</span>
    <span class="k">assert</span> <span class="n">networks</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">ecosystem</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ethereum&quot;</span>

    <span class="k">with</span> <span class="n">networks</span><span class="o">.</span><span class="n">fantom</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">use_provider</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">provider</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">provider</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">ecosystem</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fantom&quot;</span>

    <span class="c1"># You can also use the context manager like this:</span>
    <span class="k">with</span> <span class="n">networks</span><span class="o">.</span><span class="n">parse_network_choice</span><span class="p">(</span><span class="s2">&quot;fantom:local:test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">provider</span><span class="p">:</span>
       <span class="k">assert</span> <span class="n">provider</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">ecosystem</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fantom&quot;</span>
</pre></div>
</div>
<p>You can also set the network context in a pytest fixture.
This is useful if certain fixtures must run in certain networks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">stark_contract</span><span class="p">(</span><span class="n">networks</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">networks</span><span class="o">.</span><span class="n">parse_network_choice</span><span class="p">(</span><span class="s2">&quot;starknet:local&quot;</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">project</span><span class="o">.</span><span class="n">MyStarknetContract</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_starknet_thing</span><span class="p">(</span><span class="n">stark_contract</span><span class="p">,</span> <span class="n">stark_account</span><span class="p">):</span>
    <span class="c1"># Uses the starknet connection via the stark_contract fixture</span>
    <span class="n">receipt</span> <span class="o">=</span> <span class="n">stark_contract</span><span class="o">.</span><span class="n">my_method</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">stark_account</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">receipt</span><span class="o">.</span><span class="n">failed</span>
</pre></div>
</div>
<p>When you exit a provider’s context, Ape <strong>does not</strong> disconnect the provider.
When you re-enter that provider’s context, Ape uses the previously-connected provider.
At the end of the tests, Ape disconnects all the providers.
Thus, you can enter and exit a provider’s context as much as you need in tests.</p>
</section>
<section id="gas-reporting">
<h2>Gas Reporting<a class="headerlink" href="#gas-reporting" title="Permalink to this heading"></a></h2>
<p>To include a gas report at the end of your tests, you can use the <code class="docutils literal notranslate"><span class="pre">--gas</span></code> flag.
<strong>NOTE</strong>: This feature requires using a provider with tracing support, such as <a class="reference external" href="https://github.com/ApeWorX/ape-hardhat">ape-hardhat</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--network<span class="w"> </span>ethereum:local:hardhat<span class="w"> </span>--gas
</pre></div>
</div>
<p>At the end of test suite, you will see tables such as:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">                            </span>FundMe<span class="w"> </span>Gas

<span class="w">  </span>Method<span class="w">           </span>Times<span class="w"> </span>called<span class="w">    </span>Min.<span class="w">    </span>Max.<span class="w">    </span>Mean<span class="w">   </span>Median
<span class="w"> </span>────────────────────────────────────────────────────────────────
<span class="w">  </span>fund<span class="w">                        </span><span class="m">8</span><span class="w">   </span><span class="m">57198</span><span class="w">   </span><span class="m">91398</span><span class="w">   </span><span class="m">82848</span><span class="w">    </span><span class="m">91398</span>
<span class="w">  </span>withdraw<span class="w">                    </span><span class="m">2</span><span class="w">   </span><span class="m">28307</span><span class="w">   </span><span class="m">38679</span><span class="w">   </span><span class="m">33493</span><span class="w">    </span><span class="m">33493</span>
<span class="w">  </span>changeOnStatus<span class="w">              </span><span class="m">2</span><span class="w">   </span><span class="m">23827</span><span class="w">   </span><span class="m">45739</span><span class="w">   </span><span class="m">34783</span><span class="w">    </span><span class="m">34783</span>
<span class="w">  </span>getSecret<span class="w">                   </span><span class="m">1</span><span class="w">   </span><span class="m">24564</span><span class="w">   </span><span class="m">24564</span><span class="w">   </span><span class="m">24564</span><span class="w">    </span><span class="m">24564</span>

<span class="w">                  </span>Transferring<span class="w"> </span>ETH<span class="w"> </span>Gas

<span class="w">  </span>Method<span class="w">     </span>Times<span class="w"> </span>called<span class="w">   </span>Min.<span class="w">   </span>Max.<span class="w">   </span>Mean<span class="w">   </span>Median
<span class="w"> </span>───────────────────────────────────────────────────────
<span class="w">  </span>to:test0<span class="w">              </span><span class="m">2</span><span class="w">   </span><span class="m">2400</span><span class="w">   </span><span class="m">9100</span><span class="w">   </span><span class="m">5750</span><span class="w">     </span><span class="m">5750</span>

<span class="w">                     </span>TestContract<span class="w"> </span>Gas

<span class="w">  </span>Method<span class="w">      </span>Times<span class="w"> </span>called<span class="w">    </span>Min.<span class="w">    </span>Max.<span class="w">    </span>Mean<span class="w">   </span>Median
<span class="w"> </span>───────────────────────────────────────────────────────────
<span class="w">  </span>setNumber<span class="w">              </span><span class="m">1</span><span class="w">   </span><span class="m">51021</span><span class="w">   </span><span class="m">51021</span><span class="w">   </span><span class="m">51021</span><span class="w">    </span><span class="m">51021</span>
</pre></div>
</div>
<p>The following demonstrates how to use the <code class="docutils literal notranslate"><span class="pre">ape-config.yaml</span></code> file to exclude contracts and / or methods from the gas report:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gas</span><span class="p">:</span>
<span class="w">    </span><span class="nt">exclude</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">method_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG_*</span><span class="w">         </span><span class="c1"># Exclude all methods starting with `DEBUG_`.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">contract_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MockToken</span><span class="w">     </span><span class="c1"># Exclude all methods in contract named `MockToken`.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">contract_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PoolContract</span><span class="w">  </span><span class="c1"># Exclude methods starting with `reset_` in `PoolContract`.</span>
<span class="w">        </span><span class="nt">method_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reset_*</span>
</pre></div>
</div>
<p>Similarly, you can exclude sources via the CLI option <code class="docutils literal notranslate"><span class="pre">--gas-exclude</span></code>.
The value <code class="docutils literal notranslate"><span class="pre">--gas-exclude</span></code> takes is a comma-separated list of colon-separated values representing the structure similar as above, except you must explicitly use <code class="docutils literal notranslate"><span class="pre">*</span></code> where meaning “all”.
For example to exclude all methods starting with <code class="docutils literal notranslate"><span class="pre">DEBUG_</span></code>, you would do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--gas<span class="w"> </span>--gas-exclude<span class="w"> </span><span class="s2">&quot;*:DEBUG_*&quot;</span>.
</pre></div>
</div>
<p>To exclude all methods in the <code class="docutils literal notranslate"><span class="pre">MockToken</span></code> contract, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--gas<span class="w"> </span>--gas-exclude<span class="w"> </span>MockToken
</pre></div>
</div>
<p>And finally, to exclude all methods starting with <code class="docutils literal notranslate"><span class="pre">reset_</span></code> in <code class="docutils literal notranslate"><span class="pre">PoolContract</span></code>, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--gas<span class="w"> </span>--gas-exclude<span class="w"> </span><span class="s2">&quot;PoolContract:reset_*&quot;</span>
</pre></div>
</div>
</section>
<section id="iterative-testing">
<h2>Iterative Testing<a class="headerlink" href="#iterative-testing" title="Permalink to this heading"></a></h2>
<p>Ape has a set of flags that controls running your test suite locally in a “watch” mode,
which means watching for updates to files in your project and re-triggering the test suite.</p>
<p>To enable this mode, run <code class="docutils literal notranslate"><span class="pre">ape</span> <span class="pre">test</span> <span class="pre">--watch</span></code> to set up this mode using the default settings.
While in this mode, any time a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file (i.e. your tests) or smart contract source file
(i.e. any files that get compiled using your installed compiler plugins) is added, removed,
or changed, then the <code class="docutils literal notranslate"><span class="pre">ape</span> <span class="pre">test</span></code> task will be re-triggered, based on a polling interval.</p>
<p>To exit this mode, press Ctrl+D (on Linux or macOS) to stop the execution and undo it.</p>
</section>
<section id="contract-coverage">
<h2>Contract Coverage<a class="headerlink" href="#contract-coverage" title="Permalink to this heading"></a></h2>
<p>To get contract coverage, use the <code class="docutils literal notranslate"><span class="pre">--coverage</span></code> flag when running <code class="docutils literal notranslate"><span class="pre">ape</span> <span class="pre">test</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--coverage
</pre></div>
</div>
<p><strong>NOTE</strong>: Some types of coverage require using a provider that supports transaction tracing, such as <code class="docutils literal notranslate"><span class="pre">ape-hardhat</span></code> or <code class="docutils literal notranslate"><span class="pre">ape-foundry</span></code>.</p>
<p>Afterwards, you should see a coverage report looking something like:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">=============================================</span><span class="w"> </span>Coverage<span class="w"> </span><span class="nv">Profile</span><span class="w"> </span><span class="o">=============================================</span>
<span class="w">               </span>Contract<span class="w"> </span>Coverage<span class="w">               </span>
<span class="w">                                               </span>
<span class="w">  </span>Name<span class="w">          </span>Stmts<span class="w">   </span>Miss<span class="w">   </span>Cover<span class="w">    </span>Funcs<span class="w">  </span>
<span class="w"> </span>─────────────────────────────────────────────<span class="w"> </span>
<span class="w">  </span>Contract.vy<span class="w">   </span><span class="m">7</span><span class="w">       </span><span class="m">1</span><span class="w">      </span><span class="m">85</span>.71%<span class="w">   </span><span class="m">80</span>.0%<span class="w"> </span>
</pre></div>
</div>
<p>To generate other coverage reports such as XML or HTML, configure it like so:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">coverage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">terminal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w">  </span><span class="c1"># Disable the terminal table (True by default)</span>
<span class="w">      </span><span class="nt">xml</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">  </span><span class="c1"># Enable XML report (.build/coverage.xml)</span>
<span class="w">      </span><span class="nt">html</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">  </span><span class="c1"># Enable HTML report (.build/htmlcov)</span>
</pre></div>
</div>
<p>To see a much more verbose coverage report, set the <code class="docutils literal notranslate"><span class="pre">terminal</span></code> field to a dictionary that includes <code class="docutils literal notranslate"><span class="pre">&quot;verbose&quot;:</span> <span class="pre">true</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">coverage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">terminal</span><span class="p">:</span>
<span class="w">        </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Show verbose coverage information in the terminal.</span>
</pre></div>
</div>
<p>Then, you will see table outputs like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">=====================================</span><span class="w"> </span>Coverage<span class="w"> </span><span class="nv">Profile</span><span class="w"> </span><span class="o">========================================</span>
<span class="w">                </span>MyContract<span class="w"> </span>Coverage

<span class="w">                         </span>Func<span class="w">   </span>Stmts<span class="w">   </span>Miss<span class="w">    </span>Cover
<span class="w"> </span>─────────────────────────────────────────────────────
<span class="w">                  </span>__builtin__<span class="w">       </span><span class="m">2</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%
<span class="w">            </span>_immutable_number<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%
<span class="w">                      </span>_number<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%
<span class="w">                 </span>foo_method<span class="o">()</span><span class="w">       </span><span class="m">1</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%
<span class="w">          </span>foo_method<span class="o">(</span>uint256<span class="o">)</span><span class="w">       </span><span class="m">1</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%
<span class="w">  </span>foo_method<span class="o">(</span>uint256,uint256<span class="o">)</span><span class="w">       </span><span class="m">3</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%
<span class="w">                  </span>view_method<span class="w">       </span><span class="m">1</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>.0%

<span class="w">           </span><span class="nv">line</span><span class="o">=</span><span class="m">0</span>.0%,<span class="w"> </span><span class="nv">func</span><span class="o">=</span><span class="m">0</span>.0%
</pre></div>
</div>
<p>This is useful when trying to find the missing areas to cover.
The HTML report also supports <code class="docutils literal notranslate"><span class="pre">verbose:</span> <span class="pre">true</span></code> and it will show similar tables.</p>
<p><strong>NOTE</strong>: You may notice methods with zero statements.
One example of a method with zero statements may be from an auto-generated getter method for a public variable; certain versions of Vyper do not contain source mappings for these methods.
However, Ape will still check to see if this method has been called in your tests.
To get 100% coverage, you must call these methods in your tests.</p>
<p><strong>NOTE</strong>: Notice some methods use the full selector while others don’t.
Methods that use the selector mean that their short name is shared with other methods.
This happens in Vyper from auto-generated kwarg-based methods.
Thus, the full selector is used to distinguish the methods in the coverage (and gas) reports.</p>
<p>Much like gas reporting, you can also exclude contracts and methods from tracking coverage using your <code class="docutils literal notranslate"><span class="pre">ape-config.yaml</span></code> file.
The following demonstrates how to do this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">coverage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">exclude</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">method_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG_*</span><span class="w">         </span><span class="c1"># Exclude all methods starting with `DEBUG_`.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">contract_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MockToken</span><span class="w">     </span><span class="c1"># Exclude all methods in contract named `MockToken`.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">contract_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PoolContract</span><span class="w">  </span><span class="c1"># Exclude methods starting with `reset_` in `PoolContract`.</span>
<span class="w">        </span><span class="nt">method_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reset_*</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="proxy.html" class="btn btn-neutral float-left" title="Proxy Contracts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scripts.html" class="btn btn-neutral float-right" title="Scripting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ApeWorX LTD.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  
      <li><a href="https://github.com/ApeWorX/ape
      /blob/main//docs/userguides/testing.rst">
      Show on GitHub</a></li>
  

</body>
</html>