<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contracts &mdash; ape  documentation</title>
      <link rel="stylesheet" href="/ape/latest/_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="/ape/latest/_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="/ape/latest/_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="/ape/userguides/contracts.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script data-domain="docs.apeworx.io" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/custom.js"></script>
  <script>
      var PROJECT = "ape";
  </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Proxy Contracts" href="proxy.html" />
    <link rel="prev" title="Ape Console" href="console.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ape
              <img src="../_static/logo.gif" class="logo" alt="Logo"/>
          </a>

          <div class="version">
            <label for="version-picker" id="version-picker-label">Version:</label>
            <select id="version-picker">
              <option value="">Select version...</option>
              <option value="latest">latest</option>
              <option value="stable">stable</option>
                <option value="v0.7.10">v0.7.10</option>
                <option value="v0.7.9">v0.7.9</option>
                <option value="v0.7.8">v0.7.8</option>
                <option value="v0.7.7">v0.7.7</option>
                <option value="v0.7.6">v0.7.6</option>
                <option value="v0.7.5">v0.7.5</option>
                <option value="v0.7.4">v0.7.4</option>
                <option value="v0.7.3">v0.7.3</option>
                <option value="v0.7.2">v0.7.2</option>
                <option value="v0.7.1">v0.7.1</option>
                <option value="v0.7.0">v0.7.0</option>
                <option value="v0.6.27">v0.6.27</option>
                <option value="v0.6.26">v0.6.26</option>
                <option value="v0.6.25">v0.6.25</option>
                <option value="v0.6.24">v0.6.24</option>
                <option value="v0.6.23">v0.6.23</option>
                <option value="v0.6.22">v0.6.22</option>
                <option value="v0.6.21">v0.6.21</option>
                <option value="v0.6.20">v0.6.20</option>
                <option value="v0.6.19">v0.6.19</option>
                <option value="v0.6.18">v0.6.18</option>
                <option value="v0.6.17">v0.6.17</option>
                <option value="v0.6.16">v0.6.16</option>
                <option value="v0.6.15">v0.6.15</option>
                <option value="v0.6.14">v0.6.14</option>
                <option value="v0.6.13">v0.6.13</option>
                <option value="v0.6.12">v0.6.12</option>
                <option value="v0.6.11">v0.6.11</option>
                <option value="v0.6.10">v0.6.10</option>
                <option value="v0.6.9">v0.6.9</option>
                <option value="v0.6.8">v0.6.8</option>
                <option value="v0.6.7">v0.6.7</option>
                <option value="v0.6.6">v0.6.6</option>
                <option value="v0.6.5">v0.6.5</option>
                <option value="v0.6.4">v0.6.4</option>
                <option value="v0.6.3">v0.6.3</option>
                <option value="v0.6.2">v0.6.2</option>
                <option value="v0.6.1">v0.6.1</option>
                <option value="v0.6.0">v0.6.0</option>
                <option value="v0.5.9">v0.5.9</option>
                <option value="v0.5.8">v0.5.8</option>
                <option value="v0.5.7">v0.5.7</option>
                <option value="v0.5.6">v0.5.6</option>
                <option value="v0.5.5">v0.5.5</option>
                <option value="v0.5.4">v0.5.4</option>
                <option value="v0.5.3">v0.5.3</option>
                <option value="v0.5.2">v0.5.2</option>
                <option value="v0.5.1">v0.5.1</option>
                <option value="v0.5.0">v0.5.0</option>
                <option value="v0.4.5">v0.4.5</option>
                <option value="v0.4.4">v0.4.4</option>
                <option value="v0.4.3">v0.4.3</option>
                <option value="v0.4.2">v0.4.2</option>
                <option value="v0.4.1">v0.4.1</option>
                <option value="v0.4.0">v0.4.0</option>
                <option value="v0.3.5">v0.3.5</option>
                <option value="v0.3.4">v0.3.4</option>
                <option value="v0.3.3">v0.3.3</option>
                <option value="v0.3.2">v0.3.2</option>
                <option value="v0.3.1">v0.3.1</option>
                <option value="v0.3.0">v0.3.0</option>
                <option value="v0.2.8">v0.2.8</option>
                <option value="v0.2.7">v0.2.7</option>
                <option value="v0.2.6">v0.2.6</option>
                <option value="v0.2.5">v0.2.5</option>
                <option value="v0.2.4">v0.2.4</option>
                <option value="v0.2.3">v0.2.3</option>
                <option value="v0.2.2">v0.2.2</option>
                <option value="v0.2.1">v0.2.1</option>
                <option value="v0.2.0">v0.2.0</option>
                <option value="v0.1.6">v0.1.6</option>
                <option value="v0.1.5">v0.1.5</option>
                <option value="v0.1.4">v0.1.4</option>
                <option value="v0.1.3">v0.1.3</option>
                <option value="v0.1.1">v0.1.1</option>
                <option value="v0.1.0">v0.1.0</option>
            </select>
          </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Developing Projects with Ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="compile.html">Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="clis.html">CLIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Querying Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="forking_networks.html">Forking Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_plugins.html">Developing Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configure Ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Making Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html">Ape Console</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#from-deploy">From Deploy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deploy-scripts">Deploy Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publishing">Publishing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#from-project-contract-address">From Project Contract Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="#from-any-address">From Any Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="#from-abis">From ABIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#from-previous-deployment">From Previous Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contract-interaction">Contract Interaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transactions">Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calls">Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calling-transactions-and-transacting-calls">Calling Transactions and Transacting Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-fallback-and-direct-calls">Default, Fallback, and Direct Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#private-transactions">Private Transactions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#decoding-and-encoding-inputs">Decoding and Encoding Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contract-interface-introspection">Contract Interface Introspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-call-and-multi-transaction">Multi-Call and Multi-Transaction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="publishing.html">Publishing</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CLI Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../commands/accounts.html">accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/compile.html">compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/pm.html">pm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/console.html">console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/init.html">init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/networks.html">networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/plugins.html">plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/run.html">run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/test.html">test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape.html">ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_accounts.html">ape-accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/api.html">ape.api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/cli.html">ape.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/contracts.html">ape.contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/exceptions.html">ape.exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/managers.html">ape.managers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/plugins.html">ape.plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/types.html">ape.types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/utils.html">ape.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ape</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Contracts</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ApeWorX/ape/blob/main/docs/userguides/contracts.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="contracts">
<h1>Contracts<a class="headerlink" href="#contracts" title="Permalink to this heading"></a></h1>
<p>You can interact with contracts pythonically using ape!
First, we need to obtain a contract instance.
One way to do this is to deploy a contract.
The other way is to initialize an already-deployed contract using its address.</p>
<section id="from-deploy">
<h2>From Deploy<a class="headerlink" href="#from-deploy" title="Permalink to this heading"></a></h2>
<p>Deploy contracts from your project using the <code class="docutils literal notranslate"><span class="pre">project</span></code> root-level object.
You deploy contracts using Python functions such as <a class="reference external" href="../methoddocs/api.html#ape.api.accounts.AccountAPI.deploy">AccountAPI.deploy</a> or <a class="reference external" href="../methoddocs/contracts.html#ape.contracts.base.ContractContainer.deploy">ContractContainer.deploy</a>.</p>
<p><strong>NOTE</strong>: You can run Ape’s deploy functions from anywhere you run Python!</p>
<p>You need both an account and a contract in order to deploy a contract, as the deployment process requires a transaction to submit the contract data to the blockchain.
To learn about accounts and how to use them, see the <a class="reference external" href="./accounts.html">Accounts Guide</a>.
You also need the contract.
You can access contract types from Ape’s root-level <code class="docutils literal notranslate"><span class="pre">project</span></code> object (e.g. <code class="docutils literal notranslate"><span class="pre">project.MyContract</span></code>) and their types are <a class="reference external" href="../methoddocs/contracts.html#ape.contracts.base.ContractContainer">ContractContainer</a>.</p>
<p>Let’s assume you have a Vyper contract like this:</p>
<div class="highlight-vyper notranslate"><div class="highlight"><pre><span></span><span class="n">contract</span><span class="w"> </span><span class="nv">MySmartContract:</span>
<span class="w">    </span><span class="nv">owner:</span><span class="w"> </span><span class="kd">public</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="w">    </span><span class="nv">balance:</span><span class="w"> </span><span class="kd">public</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@public</span>
<span class="w">    </span><span class="nd">@payable</span>
<span class="w">    </span><span class="nd">@public</span>
<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">__init__</span><span class="p">(</span><span class="nv">arg1:</span><span class="w"> </span><span class="kt">uint256</span><span class="p">,</span><span class="w"> </span><span class="nv">arg2:</span><span class="w"> </span><span class="kt">address</span><span class="p">):</span>
<span class="w">        </span><span class="na">self</span><span class="p">.</span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg2</span>
<span class="w">        </span><span class="na">self</span><span class="p">.</span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg1</span>
</pre></div>
</div>
<p>Before you can deploy this contract, you must ensure it was compiled.
To learn about compiling in Ape, please see <a class="reference external" href="./compile.html">this guide</a>.</p>
<p>After it is compiled, you can deploy it.
Here is a basic example of Python code to deploy a contract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">project</span>

<span class="c1"># You need an account to deploy, as it requires a transaction.</span>
<span class="n">account</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;&lt;ALIAS&gt;&quot;</span><span class="p">)</span>  <span class="c1"># NOTE: &lt;ALIAS&gt; refers to your account alias!</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>

<span class="c1"># NOTE: You can also do it this way:</span>
<span class="n">contract2</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</pre></div>
</div>
<p>The arguments to the constructor (<code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">account</span></code>) can be in Python form.
Ape will automatically convert values in your transactions, thus allowing you to provide higher-level objects or abstractions as input types.
That is why, as you can see, the second argument is an <code class="docutils literal notranslate"><span class="pre">AccountAPI</span></code> object for the type <code class="docutils literal notranslate"><span class="pre">address</span></code> in the contract.</p>
<p>Notice in the example, we use <code class="docutils literal notranslate"><span class="pre">project.MyContract</span></code> to access the contract type.
To avoid naming collisions with other properties on the <code class="docutils literal notranslate"><span class="pre">project</span></code> object, you can alternatively use the <a class="reference external" href="../methoddocs/managers.html#ape.managers.project.manager.ProjectManager.get_contract">get_contract()</a> method to retrieve contract containers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">project</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">get_contract</span><span class="p">(</span><span class="s2">&quot;MyContract&quot;</span><span class="p">)</span>  <span class="c1"># Same as `project.MyContract`.</span>
</pre></div>
</div>
<p>Notice when deploying, we have to specify the <code class="docutils literal notranslate"><span class="pre">sender=</span></code> kwarg because <code class="docutils literal notranslate"><span class="pre">deploy</span></code> operations are transactions.
To learn more about contract interaction via transactions, see the <a class="reference external" href="#contract-interaction">Contract Interaction</a> section below and the <a class="reference external" href="./transactions.html">guide on transactions</a>.</p>
<section id="deploy-scripts">
<h3>Deploy Scripts<a class="headerlink" href="#deploy-scripts" title="Permalink to this heading"></a></h3>
<p>Often time, the deployment process may be unique or complex.
Or possibly, you need to run the deploy-logic from CI or in a repeatable fashion.
Or perhaps, you just want to avoid having to invoking Python directly.
In those cases, you can use Ape’s scripting system to save time and store your deployment logic.
Simply copy your Python logic into an Ape script and run it via:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ape<span class="w"> </span>run<span class="w"> </span>&lt;my-deploy-script&gt;
</pre></div>
</div>
<p>Learn how to do this and scripting in its entirity by reviewing <a class="reference external" href="./scripts.html">the scripting user-guide</a>.</p>
<p><strong>There is no root <code class="docutils literal notranslate"><span class="pre">ape</span></code> command to deploy contracts; only the scripting-system, the <code class="docutils literal notranslate"><span class="pre">console</span></code>, or merely using Ape as a Python library</strong>.</p>
<p>If your deployment process is simple or only needs to happen once, it is easy to use <code class="docutils literal notranslate"><span class="pre">ape</span> <span class="pre">console</span></code> to achieve a deployment.
More information on how to use <code class="docutils literal notranslate"><span class="pre">ape</span> <span class="pre">console</span></code> can be found <a class="reference external" href="./console.html">here</a>.</p>
</section>
<section id="publishing">
<h3>Publishing<a class="headerlink" href="#publishing" title="Permalink to this heading"></a></h3>
<p>You can also publish the contract source code to an explorer upon deployment using the <code class="docutils literal notranslate"><span class="pre">publish=</span></code> kwarg on the deploy methods.
More information on publishing contracts can be found in <a class="reference external" href="./publishing.html">this guide</a>.</p>
</section>
</section>
<section id="from-project-contract-address">
<h2>From Project Contract Address<a class="headerlink" href="#from-project-contract-address" title="Permalink to this heading"></a></h2>
<p>You can also use the <a class="reference external" href="../methoddocs/contracts.html#ape.contracts.base.ContractContainer.at">at() method</a> from the same top-level project manager when you know the address of an already-deployed contract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">project</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="s2">&quot;0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="from-any-address">
<h2>From Any Address<a class="headerlink" href="#from-any-address" title="Permalink to this heading"></a></h2>
<p>If you already know the address of a contract, you can create instances of it using the <code class="docutils literal notranslate"><span class="pre">Contract</span></code> top-level factory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It will fetch the <code class="docutils literal notranslate"><span class="pre">contract-type</span></code> using the explorer plugin from the active network, such as <a class="reference external" href="https://github.com/ApeWorX/ape-etherscan">ape-etherscan</a>.</p>
<p>If you have the <a class="reference external" href="https://github.com/ApeWorX/ape-ens">ENS plugin</a> installed, you can use <code class="docutils literal notranslate"><span class="pre">.eth</span></code> domain names as the argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;v2.registry.ychad.eth&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="from-abis">
<h2>From ABIs<a class="headerlink" href="#from-abis" title="Permalink to this heading"></a></h2>
<p>You can load contracts using their ABIs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span>

<span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45&quot;</span>

<span class="c1"># Using a JSON str:</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span>
    <span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="s1">&#39;[{&quot;name&quot;:&quot;foo&quot;,&quot;type&quot;:&quot;fallback&quot;, &quot;stateMutability&quot;:&quot;nonpayable&quot;}]&#39;</span>
<span class="p">)</span>

<span class="c1"># Using a JSON file path:</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="s2">&quot;abi.json&quot;</span><span class="p">)</span>

<span class="c1"># Using a Python dictionary from JSON:</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span>
    <span class="n">address</span><span class="p">,</span>
    <span class="n">abi</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;fallback&quot;</span><span class="p">,</span> <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span><span class="s2">&quot;nonpayable&quot;</span><span class="p">}]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This will create the Contract instance from the given ABI.</p>
</section>
<section id="from-previous-deployment">
<h2>From Previous Deployment<a class="headerlink" href="#from-previous-deployment" title="Permalink to this heading"></a></h2>
<p>Ape keeps track of your deployments for you so you can always refer back to a version that you deployed previously.
On live networks, this history of deployments is saved; on local networks, this history lasts for the duration of your script.</p>
<p>Let’s say you previously deployed a smart contract called <code class="docutils literal notranslate"><span class="pre">MyContract</span></code> on the rinkeby test network.
You could then refer back to it like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">project</span><span class="p">,</span> <span class="n">chain</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">my_contract</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">contracts</span><span class="o">.</span><span class="n">get_deployments</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">project</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">my_contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="o">.</span><span class="n">deployments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">my_contract</span></code> will be of type <code class="docutils literal notranslate"><span class="pre">ContractInstance</span></code>.
<code class="docutils literal notranslate"><span class="pre">get_deployments</span></code> returns a list of deployments you made of that contract type.</p>
</section>
<section id="contract-interaction">
<h2>Contract Interaction<a class="headerlink" href="#contract-interaction" title="Permalink to this heading"></a></h2>
<p>Then, after you have a contract instance, you can call methods on the contract.
For example, let’s say you have a Vyper contract containing some functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pure</span>
<span class="nd">@external</span>
<span class="k">def</span> <span class="nf">get_static_list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">DynArray</span><span class="p">[</span><span class="n">uint256</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="nd">@external</span>
<span class="k">def</span> <span class="nf">set_number</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="n">uint256</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">msg</span><span class="o">.</span><span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="s2">&quot;!authorized&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prevNumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myNumber</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">myNumber</span> <span class="o">=</span> <span class="n">num</span>
</pre></div>
</div>
<p>Notice the contract has both an external pure method and an external method that modifies state.
In EVM languages, methods that modify state require a transaction to execute because they cost money.
Modifying the storage of a contract requires gas and thus requires a sender with enough funding.
Contract calls, on the other hand, are read-operations and do not cost anything.
Thus, calls do not require specifying a <code class="docutils literal notranslate"><span class="pre">sender=</span></code> in Ape.</p>
<p>At the RPC level, Ethereum calls are performed using the <code class="docutils literal notranslate"><span class="pre">eth_call</span></code> RPC and transactions are performed using the <code class="docutils literal notranslate"><span class="pre">eth_sendTransaction</span></code> or <code class="docutils literal notranslate"><span class="pre">eth_sendRawTransaction</span></code> RPCs.</p>
<section id="transactions">
<h3>Transactions<a class="headerlink" href="#transactions" title="Permalink to this heading"></a></h3>
<p>The following example demonstrates invoking a contract’s method in Ape as a transaction.
However, take note that there is a <a class="reference external" href="./transactions.html">separate guide</a> which fully covers transactions in Ape.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">Contract</span>

<span class="n">account</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;&lt;ALIAS&gt;&quot;</span><span class="p">)</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>  <span class="c1"># Assume is deployed version of code above</span>

<span class="c1"># Transaction: Invoke the `set_number()` function, which costs Ether</span>
<span class="n">receipt</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">set_number</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">receipt</span><span class="o">.</span><span class="n">failed</span>

<span class="c1"># The receipt contains data such as `gas_used`.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">receipt</span><span class="o">.</span><span class="n">gas_used</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that transacting returns a <a class="reference external" href="../methoddocs/api.html#ape.api.transactions.ReceiptAPI">ReceiptAPI</a> object which contains all the receipt data, such as <code class="docutils literal notranslate"><span class="pre">gas_used</span></code>.</p>
<p><strong>NOTE</strong>: If you need the <code class="docutils literal notranslate"><span class="pre">return_value</span></code> from a transaction, you have to either treat transaction as a call (see the section below!) or use a provider with tracing-features enabled (such as <code class="docutils literal notranslate"><span class="pre">ape-foundry</span></code> or <code class="docutils literal notranslate"><span class="pre">ape-geth</span></code>) and access the <a class="reference external" href="../methoddocs/api.html#ape.api.transactions.ReceiptAPI.return_value">return_value</a> property on the receipt.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">receipt</span><span class="o">.</span><span class="n">return_value</span> <span class="o">==</span> <span class="mi">123</span>
</pre></div>
</div>
<p>For more general information on transactions in the Ape framework, see <a class="reference external" href="./transactions.html">this guide</a>.</p>
</section>
<section id="calls">
<h3>Calls<a class="headerlink" href="#calls" title="Permalink to this heading"></a></h3>
<p>In the Vyper code at the beginning of this section, the function <code class="docutils literal notranslate"><span class="pre">get_static_list()</span></code> is decorated as <code class="docutils literal notranslate"><span class="pre">&#64;pure</span></code> indicating that it’s read-only.
(Also in Vyper, <code class="docutils literal notranslate"><span class="pre">&#64;view</span></code> methods are read-only).
Since <code class="docutils literal notranslate"><span class="pre">get_static_list()</span></code> is read-only, we can successfully call it without a <code class="docutils literal notranslate"><span class="pre">sender=</span></code> kwarg; no funds are required.
Here is an example of making a call by checking the result of <code class="docutils literal notranslate"><span class="pre">get_static_list()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">Contract</span>

<span class="n">account</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;&lt;ALIAS&gt;&quot;</span><span class="p">)</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>

<span class="c1"># CALL: A sender is not required for calls!</span>
<span class="k">assert</span> <span class="n">contract</span><span class="o">.</span><span class="n">get_static_list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="calling-transactions-and-transacting-calls">
<h3>Calling Transactions and Transacting Calls<a class="headerlink" href="#calling-transactions-and-transacting-calls" title="Permalink to this heading"></a></h3>
<p>You can treat transactions as calls and vice-versa.</p>
<p>For example, let’s say we have a Solidity function:</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">addBalance</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">new_bal</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new_bal<span class="p">;</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To simulate the transaction without actually modifying any state, use the <code class="docutils literal notranslate"><span class="pre">.call</span></code> method from the contract transaction handler:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">addBalance</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;123&quot;</span>  <span class="c1"># The return value gets forwarded from the contract.</span>
</pre></div>
</div>
<p>Similarly, you may want to measure a call as if it were a transaction, in which case you can use the <code class="docutils literal notranslate"><span class="pre">.transact</span></code> attribute on the contract call handler:</p>
<p>Given the Solidity function:</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">getModifiedBalance</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">123</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can treat it like a transaction by doing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">Contract</span>

<span class="n">account</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;&lt;ALIAS&gt;&quot;</span><span class="p">)</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>

<span class="n">receipt</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">getModifiedBalance</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">receipt</span><span class="o">.</span><span class="n">failed</span>  <span class="c1"># Transactions return `ReceiptAPI` objects.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">receipt</span><span class="o">.</span><span class="n">gas_used</span><span class="p">)</span>  <span class="c1"># Analyze receipt gas from calls.</span>
</pre></div>
</div>
</section>
<section id="default-fallback-and-direct-calls">
<h3>Default, Fallback, and Direct Calls<a class="headerlink" href="#default-fallback-and-direct-calls" title="Permalink to this heading"></a></h3>
<p>To directly call an address, such as invoking a contract’s <code class="docutils literal notranslate"><span class="pre">fallback</span></code> or <code class="docutils literal notranslate"><span class="pre">receive</span></code> method, call a contract instance directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">accounts</span>

<span class="n">sender</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;&lt;ALIAS&gt;&quot;</span><span class="p">)</span>  <span class="c1"># NOTE: &lt;ALIAS&gt; refers to your account alias!</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x123...&quot;</span><span class="p">)</span>

<span class="c1"># Call the contract&#39;s fallback method.</span>
<span class="n">receipt</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="n">gas</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;0x123&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="private-transactions">
<h3>Private Transactions<a class="headerlink" href="#private-transactions" title="Permalink to this heading"></a></h3>
<p>If you are using a provider that allows private mempool transactions, you are able to use the <code class="docutils literal notranslate"><span class="pre">private=True</span></code> kwarg to publish your transaction into a private mempool.
For example, EVM providers likely will use the <code class="docutils literal notranslate"><span class="pre">eth_sendPrivateTransaction</span></code> RPC to achieve this.</p>
<p>To send a private transaction, do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">receipt</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">set_number</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">dev</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">private=True</span></code> is available on all contract interactions.</p>
</section>
</section>
<section id="decoding-and-encoding-inputs">
<h2>Decoding and Encoding Inputs<a class="headerlink" href="#decoding-and-encoding-inputs" title="Permalink to this heading"></a></h2>
<p>If you want to separately decode and encode inputs without sending a transaction or making a call, you can achieve this with Ape.
If you know the method you want to use when decoding or encoding, you can call methods <code class="docutils literal notranslate"><span class="pre">encode_input()</span></code> or <code class="docutils literal notranslate"><span class="pre">decode_input()</span></code> on the method handler from a contract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span>

<span class="c1"># HexBytes(0x3fb5c1cb00000000000000000000000000000000000000000000000000000000000000de)</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>
<span class="n">bytes_value</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">my_method</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>In the example above, the bytes value returned contains the method ID selector prefix <code class="docutils literal notranslate"><span class="pre">3fb5c1c</span></code>.
Alternatively, you can decode input:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">eth_pydantic_types</span> <span class="kn">import</span> <span class="n">HexBytes</span>
<span class="kn">from</span> <span class="nn">ape</span> <span class="kn">import</span> <span class="n">Contract</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>
<span class="n">selector_str</span><span class="p">,</span> <span class="n">input_dict</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">my_method</span><span class="o">.</span><span class="n">decode_input</span><span class="p">(</span><span class="n">HexBytes</span><span class="p">(</span><span class="s2">&quot;0x123...&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">selector_str</span></code> is the string version of the method ID, e.g. <code class="docutils literal notranslate"><span class="pre">my_method(unit256,uint256)</span></code>.
The input dict is a mapping of input names to their decoded values, e.g <code class="docutils literal notranslate"><span class="pre">{&quot;foo&quot;:</span> <span class="pre">2,</span> <span class="pre">&quot;owner&quot;:</span> <span class="pre">&quot;0x123...&quot;}</span></code>.
If an input does not have a name, its key is its stringified input index.</p>
<p>If you don’t know the method’s ABI and you have calldata, you can use a <code class="docutils literal notranslate"><span class="pre">ContractInstance</span></code> or <code class="docutils literal notranslate"><span class="pre">ContractContainer</span></code> directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>

<span class="c1"># Fetch a contract</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">ape</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>

<span class="c1"># Alternative, use a contract container from ape.project</span>
<span class="c1"># contract = ape.project.MyContract</span>

<span class="c1"># Only works if unique amount of args.</span>
<span class="n">bytes_value</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">method_id</span><span class="p">,</span> <span class="n">input_dict</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">decode_input</span><span class="p">(</span><span class="n">bytes_value</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="contract-interface-introspection">
<h2>Contract Interface Introspection<a class="headerlink" href="#contract-interface-introspection" title="Permalink to this heading"></a></h2>
<p>There may be times you need to figure out ABI selectors and method or event identifiers for a contract.
A contract instance provides properties to make this easy.
For instance, if you have a 4-byte hex method ID, you can return the ABI type for that method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>

<span class="n">usdc</span> <span class="o">=</span> <span class="n">ape</span><span class="o">.</span><span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48&quot;</span><span class="p">)</span>

<span class="c1"># ABI type for a hex method ID</span>
<span class="k">assert</span> <span class="n">usdc</span><span class="o">.</span><span class="n">identifier_lookup</span><span class="p">[</span><span class="s1">&#39;0x70a08231&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selector</span> <span class="o">==</span> <span class="s1">&#39;balanceOf(address)&#39;</span>

<span class="c1"># Also, selectors from method and event signatures</span>
<span class="k">assert</span> <span class="n">usdc</span><span class="o">.</span><span class="n">selector_identifiers</span><span class="p">[</span><span class="s2">&quot;balances(address)&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;0x27e235e3&quot;</span>

<span class="c1"># Or dump all selectors and IDs</span>
<span class="k">for</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">abi_type</span> <span class="ow">in</span> <span class="n">usdc</span><span class="o">.</span><span class="n">identifier_lookup</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">abi_type</span><span class="p">)</span>
    <span class="c1"># 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef type=&#39;event&#39; name=&#39;Transfer&#39; inputs=...</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>These include methods and error IDs, as well as event topics.</p>
</section>
<section id="multi-call-and-multi-transaction">
<h2>Multi-Call and Multi-Transaction<a class="headerlink" href="#multi-call-and-multi-transaction" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ape_ethereum</span></code> core plugin comes with a <code class="docutils literal notranslate"><span class="pre">multicall</span></code> module containing tools for interacting with the <a class="reference external" href="https://github.com/mds1/multicall">multicall3 smart contract</a>.
Multicall allows you to group function calls and transactions into a single call or transaction.</p>
<p>Here is an example of how you can use the multicall module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ape</span>
<span class="kn">from</span> <span class="nn">ape_ethereum</span> <span class="kn">import</span> <span class="n">multicall</span>


<span class="n">ADDRESSES</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;0xF4b8A02D4e8D76070bD7092B54D2cBbe90fa72e9&quot;</span><span class="p">,</span> <span class="s2">&quot;0x80067013d7F7aF4e86b3890489AcAFe79F31a4Cb&quot;</span><span class="p">)</span>
<span class="n">POOLS</span> <span class="o">=</span> <span class="p">[</span><span class="n">ape</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">IPool</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ADDRESSES</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Use multi-call.</span>
    <span class="n">call</span> <span class="o">=</span> <span class="n">multicall</span><span class="o">.</span><span class="n">Call</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">POOLS</span><span class="p">:</span>
        <span class="n">call</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">getReserves</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">call</span><span class="p">()))</span>
    
    <span class="c1"># Use multi-transaction.</span>
    <span class="n">tx</span> <span class="o">=</span> <span class="n">multicall</span><span class="o">.</span><span class="n">Transaction</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">POOLS</span><span class="p">:</span>
        <span class="n">tx</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">ApplyDiscount</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
    
    <span class="n">acct</span> <span class="o">=</span> <span class="n">ape</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;signer&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tx</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">acct</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="console.html" class="btn btn-neutral float-left" title="Ape Console" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="proxy.html" class="btn btn-neutral float-right" title="Proxy Contracts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ApeWorX LTD.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  
      <li><a href="https://github.com/ApeWorX/ape
      /blob/main//docs/userguides/contracts.rst">
      Show on GitHub</a></li>
  

</body>
</html>